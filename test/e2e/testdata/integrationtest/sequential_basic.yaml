---
apiVersion: infra.testplane.io/v1alpha1
kind: IntegrationTest
metadata:
  name: e2e-sequential-basic
  namespace: default
  labels:
    app.kubernetes.io/managed-by: testplane-e2e
spec:
  mode: Sequential
  steps:
    - name: create-deployment
      timeoutSeconds: 120
      template:
        manifest:
          apiVersion: apps/v1
          kind: Deployment
          metadata:
            name: e2e-test-nginx
            namespace: default
            labels:
              app.kubernetes.io/managed-by: testplane-e2e
          spec:
            replicas: 1
            selector:
              matchLabels:
                app: e2e-test-nginx
            template:
              metadata:
                labels:
                  app: e2e-test-nginx
              spec:
                containers:
                  - name: nginx
                    image: library/nginx:1.14
                    ports:
                      - containerPort: 80
      expectations:
        timeoutSeconds: 60
        allOf:
          - function: ResourceExists

    - name: scale-up
      timeoutSeconds: 120
      template:
        manifest:
          apiVersion: apps/v1
          kind: Deployment
          metadata:
            name: e2e-test-nginx
            namespace: default
          spec:
            replicas: 2
            selector:
              matchLabels:
                app: e2e-test-nginx
            template:
              metadata:
                labels:
                  app: e2e-test-nginx
              spec:
                containers:
                  - name: nginx
                    image: library/nginx:1.14
                    ports:
                      - containerPort: 80
      expectations:
        timeoutSeconds: 60
        allOf:
          - function: ResourceExists

    - name: delete-deployment
      timeoutSeconds: 120
      template:
        action: Delete
        manifest:
          apiVersion: apps/v1
          kind: Deployment
          metadata:
            name: e2e-test-nginx
            namespace: default
      expectations:
        timeoutSeconds: 60
        allOf:
          - function: ResourceNotExists
